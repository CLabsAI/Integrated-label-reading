import cv2
import tkinter as tk
from tkinter import ttk
import base64
import re
import os
import pickle
from googleapiclient.discovery import build
from google_auth_oauthlib.flow import InstalledAppFlow
from google.auth.transport.requests import Request
import matplotlib.pyplot as plt
import numpy as np

# Your Vision API key
vision_api_key = 'YOUR_VISION_API_KEY'

# Google Sheets API
SCOPES = ['https://www.googleapis.com/auth/spreadsheets']
SPREADSHEET_ID = 'YOUR_SPREADSHEET_ID'
RANGE_NAME = 'YOUR_SHEET_NAME'

def capture_image():
    # ... [Same as the modified capture_image function from the first code]

def send_to_vision_and_sheets(image):
    # Convert the OpenCV image to PNG format in memory
    success, encoded_image = cv2.imencode('.png', image)
    if not success:
        print("Error encoding image")
        return

    # Convert the image to base64
    encoded_image_data = base64.b64encode(encoded_image.tobytes()).decode('UTF-8')

    # ... [Rest of the second code, using encoded_image_data instead of reading from a file]

# Capture the image
captured_frame = capture_image()

# Send the captured image to Vision API and then to Google Sheets
send_to_vision_and_sheets(captured_frame)
